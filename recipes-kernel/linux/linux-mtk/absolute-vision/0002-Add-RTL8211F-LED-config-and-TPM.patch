From f5e1a88ab02817172d2d5d0204f07ca8abfd4484 Mon Sep 17 00:00:00 2001
From: Dinesh kumar v <deepak.s@adlinktech.com>
Date: Mon, 11 Aug 2025 18:56:11 +0530
Subject: [PATCH] Add RTL8211F LED config and TPM

---
 drivers/char/tpm/Kconfig  |  1 +
 drivers/net/phy/realtek.c | 34 +++++++++++++++++++++++++++++++++-
 2 files changed, 34 insertions(+), 1 deletion(-)

diff --git a/drivers/char/tpm/Kconfig b/drivers/char/tpm/Kconfig
index 927088b2c3d3..30cef155a558 100644
--- a/drivers/char/tpm/Kconfig
+++ b/drivers/char/tpm/Kconfig
@@ -76,6 +76,7 @@ config TCG_TIS_SPI_CR50
 
 config TCG_TIS_I2C
 	tristate "TPM Interface Specification 1.3 Interface / TPM 2.0 FIFO Interface - (I2C - generic)"
+	default y
 	depends on I2C
 	select CRC_CCITT
 	select TCG_TIS_CORE
diff --git a/drivers/net/phy/realtek.c b/drivers/net/phy/realtek.c
index 337899c69738..5b99455a437a 100644
--- a/drivers/net/phy/realtek.c
+++ b/drivers/net/phy/realtek.c
@@ -94,6 +94,33 @@ static int rtl821x_write_page(struct phy_device *phydev, int page)
 	return __phy_write(phydev, RTL821x_PAGE_SELECT, page);
 }
 
+static int rtl8211f_config_led(struct phy_device *phydev)
+{
+	int ret;
+	u16 regValue;
+
+	ret = phy_write(phydev, RTL821x_PAGE_SELECT, 0x0d04);
+	if (ret < 0)
+		return ret;
+
+	ret = phy_read(phydev, 0x10);
+	if (ret < 0)
+		return ret;
+	regValue = ret;
+
+	regValue |= (0x5 << 6) | (0xB << 10);
+	regValue &= ~(0x1 << 9);
+
+	dev_info(&phydev->mdio.dev, "RTL8211F LED config: writing reg[0x10] = 0x%04x\n", regValue);
+
+	ret = phy_write(phydev, 0x10, regValue);
+	if (ret < 0)
+		return ret;
+
+	ret = phy_write(phydev, RTL821x_PAGE_SELECT, 0x0);
+	return ret;
+}
+
 static int rtl821x_probe(struct phy_device *phydev)
 {
 	struct device *dev = &phydev->mdio.dev;
@@ -421,6 +448,10 @@ static int rtl8211f_config_init(struct phy_device *phydev)
 				ERR_PTR(ret));
 			return ret;
 		}
+		ret = rtl8211f_config_led(phydev);
+		if (ret < 0) {
+			return ret;
+		}
 
 		return genphy_soft_reset(phydev);
 	}
@@ -459,7 +490,8 @@ static int rtl821x_resume(struct phy_device *phydev)
 
 	msleep(20);
 
-	return 0;
+	return rtl8211f_config_led(phydev);
+
 }
 
 static int rtl8211e_config_init(struct phy_device *phydev)
-- 
2.49.0

